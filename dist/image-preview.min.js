!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ImagePreview=t()}(this,function(){"use strict";function i(e,t){this.set={speed:t.speed||200,slider_dis:t.slider_dis||50,images:t.list||[]},this.index=t.index||0,this._swiperDisable=!1,this.containerId=e,this.swiperLis=[],this.init()}var n="swiper-wrap-preview__hide";function o(e,t,i){return Math.min(Math.max(e,t),i)}function a(e,t){return Math.hypot(t.x-e.x,t.y-e.y)}i.prototype={init:function(){1===this.set.images.length&&(this.index=0,this._swiperDisable=!0),this.container=document.getElementById(this.containerId),this.createSwiperHTML(),this.computeWidth(),this.touchEvent(),this.sliderIndex(this.index)},createSwiperHTML:function(){var e=this.set.images,t=document.createElement("div");t.className="swiper-wrap";for(var i="",s=0;s<e.length;s++)i+='\n        <div class="swiper-wrap-item">\n            <div class="swiper-wrap-preview__image '.concat(n,'">\n                <img class="swiper-wrap__image" src="').concat(e[s],'" />\n                <div class="loading swiper-wrap__image--loading"></div>\n            </div>\n        </div>\n      ');t.innerHTML=i,this.container.appendChild(t),this.imageLoad()},imageLoad:function(){for(var e=this.container.getElementsByClassName("swiper-wrap__image"),t=0;t<e.length;t++)e[t].onload=function(e){var t=e.target,i=t.naturalWidth,s=t.naturalHeight,t=e.target.parentNode;s/i>window.innerHeight/window.innerWidth&&t.classList.add("swiper-wrap-preview__image--vertical"),t.classList.remove(n),t.removeChild(e.target.nextElementSibling)}},computeWidth:function(){this.container.offsetHeight;this.w=this.container.offsetWidth,this.swiperWrap=this.container.getElementsByClassName("swiper-wrap")[0],this.swiperLis=this.swiperWrap.getElementsByClassName("swiper-wrap-item"),this.loopCount=this.swiperLis.length,this.swiperWrap.style.width=this.w*this.loopCount+"px";for(var e=0;e<this.loopCount;e++)this.swiperLis[e].style.width=this.w+"px"},translated:function(e){this.swiperWrap.style.transform="translate3d("+e+"px,0,0)"},touchEvent:function(){var i=this,s=0;this.end={x:0},this.Tstart=function(e){i.swiperDisable||(e=(e=e||event).targetTouches[0],i.start={x:e.pageX},e=i.swiperWrap.style.transform,s=e.match(/\d+/g)[1])},this.Tmove=function(e){var t;i.swiperDisable||(t=(e=e||event).targetTouches[0],e.preventDefault(),i.end={x:.7*(t.pageX-i.start.x)},i.swiperWrap.style.transitionDuration="0ms",i.translated(-s+i.end.x,i.index))},this.Tend=function(){i.swiperDisable||(i.end.x<-i.set.slider_dis?i.index++:i.end.x>i.set.slider_dis&&i.index--,i.end.x=0,i.finished())},this.swiperWrap.addEventListener("touchstart",this.Tstart),this.swiperWrap.addEventListener("touchmove",this.Tmove),this.swiperWrap.addEventListener("touchend",this.Tend)},destrory:function(){this.swiperWrap.removeEventListener("touchstart",this.Tstart),this.swiperWrap.removeEventListener("touchmove",this.Tmove),this.swiperWrap.removeEventListener("touchend",this.Tend);var e=document.querySelector("#imagePreveiw");e.parentNode.removeChild(e)},finished:function(){this.swiperWrap.style.transitionDuration=this.set.speed+"ms",this.index<0?this.index=0:this.index>this.loopCount-1&&(this.index=this.loopCount-1),this.translated(-this.index*this.w,this.index)},sliderIndex:function(e){this.translated(-this.w*e),this.index=e},disable:function(){this.swiperDisable=!0},enable:function(){this._swiperDisable?this.swiperDisable=!0:this.swiperDisable=!1}};function s(e){this.swiper=e,this.store={scale:1},this.move={moving:!1,startX:"",startY:"",startMoveX:0,startMoveY:0,moveX:0,moveY:0},this.documentEvent()}s.prototype={documentEvent:function(){var n=this;this._dblclick=0,this.documnetTouchStart=function(e){var t=e.touches,i=t[0],e=t[1];n.store.pageX=i.pageX,n.store.pageY=i.pageY,n.move.moveable=!0,n.move.moveing=1===t.length,n.move.startMoveX=n.move.moveX,n.move.startMoveY=n.move.moveY,n.move.startX=i.clientX,n.move.startY=i.clientY,e&&(n.store.pageX2=e.pageX,n.store.pageY2=e.pageY,n.swiper.disable()),n.store.originScale=n.store.scale||1,n.imgageSacaleAnimate(!1),n.imageScale()},this.documnetTouchMove=function(e){var t,i,s;n.move.moveable&&(s=(t=e.touches)[0],(t=t[1])&&(n.swiper.disable(),n.store.pageX2||(n.store.pageX2=t.pageX),n.store.pageY2||(n.store.pageY2=t.pageY),i=a({x:s.pageX,y:s.pageY},{x:t.pageX,y:t.pageY})/a({x:n.store.pageX,y:n.store.pageY},{x:n.store.pageX2,y:n.store.pageY2}),i=n.store.originScale*i,n.store.scale=i=5<i?5:i,n.imageScale()),n.move.moveing&&(i=s.clientX-n.move.startX,s=s.clientY-n.move.startY,i=i+n.move.startMoveX,s=s+n.move.startMoveY,n.distanceX=n.maxMoveX(),n.distanceY=n.maxMoveY(),n.move.moveX=o(i,-n.distanceX,n.distanceX),n.move.moveY=o(s,-n.distanceY,n.distanceY),n.imgageSacaleAnimate(!1),n.imageScale()),e.preventDefault())},this.documnetTouchEnd=function(e){console.log("触摸结束"),n.store.scale<1&&(n.store.scale=1),1===n.store.scale?n.swiper.enable():n.swiper.disable(),e.touches.length||(n.distanceX=n.maxMoveX(),n.distanceY=n.maxMoveY(),n.move.moveX=o(n.move.moveX,-n.distanceX,n.distanceX),n.move.moveY=o(n.move.moveY,-n.distanceY,n.distanceY),n.imgageSacaleAnimate(!0),n.imageScale()),n.move.moveing=!1,n.move.moveable=!1},this.documentDblClick=function(e){n._dblclick++,setTimeout(function(){n._dblclick=0},500),1<n._dblclick&&(n.store.scale=5===n.store.scale?1:5,n.move.moveX=0,n.move.moveY=0,n.imgageSacaleAnimate(!0),n.imageScale(),1===n.store.scale?n.swiper.enable():n.swiper.disable()),setTimeout(function(){1===n._dblclick&&n.open&&n.close()},300)},document.addEventListener("touchstart",this.documnetTouchStart,{passive:!1}),document.addEventListener("touchmove",this.documnetTouchMove,{passive:!1}),document.addEventListener("touchend",this.documnetTouchEnd,{passive:!1}),this.swiper.container.addEventListener("click",this.documentDblClick)},close:function(){this.open=!1,document.removeEventListener("touchstart",this.documnetTouchStart),document.removeEventListener("touchmove",this.documnetTouchMove),document.removeEventListener("touchend",this.touchend),this.swiper.container.removeEventListener("click",this.documentDblClick),this.swiper.destrory()},imageScale:function(){var e=this.swiper,t=e.index,i=e.swiperLis,s=this.store.scale,n=this.move.moveX/s,e=this.move.moveY/s;i[t].querySelector(".swiper-wrap-preview__image").style.transform="scale(".concat(s,", ").concat(s,") translate(").concat(n,"px, ").concat(e,"px)")},imgageSacaleAnimate:function(e){var t=this.swiper,i=t.index,i=t.swiperLis[i].querySelector(".swiper-wrap-preview__image");i.style.transitionDuration=e?".3s":"0s"},maxMoveX:function(){var e=0,t=this.swiper,i=t.index,t=t.swiperLis[i].querySelector(".swiper-wrap-preview__image"),i=t.offsetWidth;return t.offsetHeight===window.innerHeight?e=0:i*this.store.scale>window.innerWidth&&(e=(i*this.store.scale-window.innerWidth)/2,e=Math.max(0,e)),console.log(e),e},maxMoveY:function(){var e=0,t=this.swiper,i=t.index,i=t.swiperLis[i].querySelector(".swiper-wrap-preview__image").offsetHeight;return i*this.store.scale>window.innerHeight&&(e=(i*this.store.scale-window.innerHeight)/2,e=Math.max(0,e)),e}};var r="imagePreveiw";function t(e){var t,t=((t=document.createElement("div")).className="image-preview",t.id=r,t);return document.body.appendChild(t),new s(new i(r,e))}function c(){}return c.instance={},c.open=function(e){e.index=e.index||0,e.list=e.list||[],c.instance=t(e),setTimeout(function(){c.instance.open=!0},500)},c.close=function(e){c.instance.close()},c});
